
@{
    Layout = "~/Views/Shared/_Layout.cshtml";
    ViewBag.Title = "Index";
}
    <script src="~/assets/js/warehouse.js"></script>
    <link href="~/assets/css/warehouse.css" rel="stylesheet" />
<style>
    #TodayReceiving_Table th, td {
        border-left: 1px solid #ccc;
        border-right: 1px solid #ccc;
    }

    #TodayReceiving_Table th {
        padding-bottom: 0 !important;
        margin-bottom: 0 !important;
    }
    .dataTables_wrapper .dataTable thead th {
        padding: 5px 30px;
    }

    table[aria-describedby="TodayReceiving_Table_info"] thead th {
        border: 1px #eee solid;
        text-align: center;
    }

    .dataTables_wrapper .dataTable {
        margin: 0 !important;
    }

    hr.myhrline {
        margin: 0px;
    }

    h4, h5, h6, p {
        margin: 2px;
    }

    div.card-body {
        padding: 1% !important;
    }
</style>
<script>
    /*-----------------------*/
    /*Initial on Webpage Load*/
    /*-----------------------*/
    var isFirstLoad = 1;
    var table = null;
    var selected_customer = [];
    var selected_dc = [];
    var submitCriteria;
    var screenID = 'WEB_ESC_001';
    var cdc_column = [
        {
            "data": "receiveddate", "name": "receiveddate", "title": "Received Date", "autoWidth": true, "className": "text-nowrap",
            "render": function (data, type, row, meta) {
                return data == null ? "" : moment(new Date(data)).format("DD/MM/YYYY");
            }
        },
        { "data": "statusid", "name": "statusid", "title": "Status Id", "autoWidth": true, "className": "text-nowrap" },
        { "data": "statusname", "name": "statusname", "title": "Status Name", "autoWidth": true, "className": "text-nowrap" },
        { "data": "po_invoice", "name": "po_invoice", "title": "Po Invoice", "autoWidth": true, "className": "text-nowrap" },
        { "data": "rc", "name": "rc", "title": "RC", "autoWidth": true, "className": "text-nowrap" },
        { "data": "ean", "name": "ean", "title": "EAN", "autoWidth": true, "className": "text-nowrap" },
        { "data": "suppliercode", "name": "Supplier Code", "title": "Supplier Code", "autoWidth": true, "className": "text-nowrap" },
        { "data": "suppliername", "name": "Supplier Name", "title": "Supplier Name", "autoWidth": true, "className": "text-nowrap" },
        { "data": "sku", "name": "sku", "title": "SKU", "autoWidth": true, "className": "text-nowrap" },
        { "data": "productbarcode", "name": "productbarcode", "title": "Product Barcode", "autoWidth": true, "className": "text-nowrap" },
        { "data": "productcode", "name": "productcode", "title": "Product Code", "autoWidth": true, "className": "text-nowrap" },
        { "data": "productdescription", "name": "productdescription", "title": "Product Description", "autoWidth": true, "className": "text-nowrap" },
        { "data": "weight", "name": "weight", "title": "Net Weight", "autoWidth": true, "className": "text-nowrap text-right", "render": uiHelpers.renderInteger },
        { "data": "volumn", "name": "volumn", "title": "Volumn", "autoWidth": true, "className": "text-nowrap text-right", "render": uiHelpers.renderInteger},
        { "data": "qty_in_ewm", "name": "qty_in_ewm", "title": "Qty In EWM", "autoWidth": true, "className": "text-nowrap text-right", "render": uiHelpers.renderInteger},
        { "data": "unit_code", "name": "unit_code", "title": "Unit Code", "autoWidth": true, "className": "text-nowrap" },
        { "data": "uom", "name": "uom", "title": "UOM", "autoWidth": true, "className": "text-nowrap" },
        { "data": "productgroupcode", "name": "Product Groupcode", "title": "Product Group Code", "autoWidth": true, "className": "text-nowrap" },
        { "data": "productgroupname", "name": "Product Groupname", "title": "Product Group Name", "autoWidth": true, "className": "text-nowrap" },
        { "data": "doctype", "name": "doctype", "title": "Doc Type", "autoWidth": true, "className": "text-nowrap" },
        { "data": "docrefno", "name": "docrefno", "title": "Doc refno", "autoWidth": true, "className": "text-nowrap" },
        { "data": "inbound", "name": "inbound", "title": "Inbound", "autoWidth": true, "className": "text-nowrap" },
        { "data": "entiled", "name": "entiled", "title": "Entiled", "autoWidth": true, "className": "text-nowrap" },
        { "data": "chargeunit", "name": "chargeunit", "title": "Charge Unit", "autoWidth": true, "className": "text-nowrap" },
        { "data": "chargeitem", "name": "chargeitem", "title": "Charge Item", "autoWidth": true, "className": "text-nowrap" },
        { "data": "customer_name", "name": "customer_name", "title": "Customer", "autoWidth": true, "className": "text-nowrap" },
        {"data": "arrival_date", "name": "arrival_date", "title": "Arrival Date", "autoWidth": true, "className": "text-nowrap", "render": uiHelpers.renderDate }
    ];

    function initialSearchCriteria() {
        var ajax = [];
        $('#CriteriaOveray').show();
        ajax.push(GetCustomerESC('ESC'));
        ajax.push(GetDCESC('ESC'));
        var result = Promise.all(ajax).finally(() => { $('#CriteriaOveray').hide(); });
        return result;
    }

    $(document).ready(function () {

        init_datepicker_criteria();

        $('#cboDC').on("change", function (element, checked) {
            GetCustomerESC('ESC', $('#cboDC').select2('data').map(x => x.id));
        });

        initialControl().then(() => {
            //ต้องทำหลังจากที่ initial control เสร็จ (พวก dropdown ที่ดึงค่ามาจาก database)
            uiHelpers.getDefaultCriteria(screenID).done((result) => { setCriteria(result.data) }).always(Search);
        });

    });

</script>

<script>
    function Search() {

        uiHelpers.initCriteria(screenID, '#search-button', setCriteria, getRequest, Search);

        submitCriteria = getRequest();

        GetSummary(submitCriteria);

        GetCompareChart(submitCriteria);

        DrawTableDetail(submitCriteria);

        GetReceivedByTimeChart(submitCriteria);
            $('#SectionTodayCompareReceived').show();
            $('#SectionYesterdayCompareReceived').show();

            $('#SectionPieChartReceivedBytime').show();
            $('#SectionBarChartReceivedBytime').show();

    }

    function getSubmitRequest(filter) {
        filter = {
            CustomerName: null || filter.CustomerName, Status: null || filter.Status, Time: null || filter.Time, Datetype: null || filter.Datetype
        };
        $('#ModalTransactionDate').text(moment(filter.orderStartDate).format('DD/MM/YYYY') + '-' + moment(filter.orderEndDate).format('DD/MM/YYYY'));
        return {
            ...submitCriteria,
            selectCustomerName: filter.CustomerName,
            selectStatus: filter.Status,
            selectTime: filter.Time,
            selectDateType: filter.Datetype
        }
    }
    
    function genTableModal(filter) {
        $('#modals-transaction').modal('show');
        generateTableLeadModal_SR('#ReceieveDetailModal', '@Url.Action("RPTESC001_RecivingReport", "Warehouse")',
            filter, '', cdc_column);
    }

    function setCriteria(data) {
        if (data == null) return;
        $('#daterange-99').data('daterangepicker').setStartDate(new Date(data.criteria.selectStartDate));
        $('#daterange-99').data('daterangepicker').setEndDate(new Date(data.criteria.selectEndDate));
        $('#cboDC').val(data.criteria.selectDc).trigger('change');
        $('#cboCustomer').val(data.criteria.selectCustomer).trigger('change');
    }

    function getRequest(CustomerName = null, Status = null, Time = null,DateType = null) {
            var customer = $('#cboCustomer').select2('data').map(x => x.id);
            var dc = $('#cboDC').select2('data').map(x => x.id);
            var tmpStartDate = $('#daterange-99').data('daterangepicker').startDate._d;
            var tmpEndDate = $('#daterange-99').data('daterangepicker').endDate._d;
            var startDate = tmpStartDate.getFullYear() + "/" + (tmpStartDate.getMonth() + 1) + "/" + tmpStartDate.getDate();
            var endDate = tmpEndDate.getFullYear() + "/" + (tmpEndDate.getMonth() + 1) + "/" + tmpEndDate.getDate();
            if (!customer) {
                customer = null;
            }
            if (!dc) {
                dc = null;
            }
            var request = {
                selectStartDate: startDate,
                selectEndDate: endDate,
                selectDc: dc,
                selectCustomer: customer,
                selectCustomerName: CustomerName,
                selectStatus: Status,
                selectTime: Time,
                selectDateType: DateType
            };
            return request;
    }

        function GetCompareChart(request) {
            $('#barChartTodayReceiving').remove();
            $('#barChartTodayReceivingContainer').append('<canvas id="barChartTodayReceiving"><canvas>');
            $('#barChartYesterdayReceiving').remove();
            $('#barChartYesterdayReceivingContainer').append('<canvas id="barChartYesterdayReceiving"><canvas>');

            var sectionreportHeader = document.getElementById('TodayReceivingDate');
            var sectionChartDate = document.getElementById('ChartDate');
            var DateDis = GetDateDisplay();
            sectionreportHeader.innerText = DateDis.StartDate + " - " + DateDis.EndDate;
            sectionChartDate.innerText = DateDis.StartDate + " - " + DateDis.EndDate;

            $.ajax({
                url: '@Url.Action("RPTESC001_TodayReceivingChart", "Warehouse")',
                type: 'POST',
                data: request,
                dataType: 'Json'
            }).done(function (response) {
                //Populate chart data and show the modal
                //PopulateDataShipmentStatus(response, reporttype);

                var ctx = document.getElementById("barChartTodayReceiving").getContext('2d');
                var myChart = new Chart(ctx, {
                    type: 'bar',
                    data: response,
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        scales: {
                            xAxes: [{
                                stacked: true,
                                ticks: {
                                    autoSkip: false,
                                    maxRotation: 15,
                                    minRotation: 0
                                },
                                scaleLabel: {
                                    display: true,
                                    labelString: 'Customer'
                                }
                            }],
                            yAxes: [{
                                stacked: true,
                                scaleLabel: {
                                    display: true,
                                    labelString: "Ton"
                                }
                            }]
                        },
                        elements: {
                            rectangle: {
                                borderWidth: 1,
                            }
                        },
                        legend: {
                            position: 'top',
                        },
                        title: {
                            display: false,
                            text: 'Receiving Today'
                        }
                    }
                });
                var canvas = document.getElementById('barChartTodayReceiving');
                canvas.onclick = function (evt) {
                    var activePoints = myChart.getElementsAtEvent(evt);
                    if (activePoints[0]) {

                        //label
                        var chartData = activePoints[0]['_chart'].config.data;
                        var idx = activePoints[0]['_index'];
                        var Customerslabel = chartData.labels[idx];

                        //data
                        var activePoint = myChart.getElementAtEvent(evt)[0];
                        var data = activePoint._chart.data;
                        var datasetIndex = activePoint._datasetIndex;
                        var status = data.datasets[datasetIndex].label;
                        console.log(Customerslabel + '/' + status);
                    }
                    genTableModal({ CustomerName: Customerslabel, Status: status, Datetype: 'P' });
                    @*DrawTableDetail(getRequest(Customerslabel, status, null,'P'));*@
                };
            }).fail(function (error) {
                console.log(error);
            }).always(function () {
                $('#SectionTodayCompareReceived').hide();
                //console.log( "finished" );
            });

            var table = $("#TodayReceiving_Table").DataTable().destroy();
            var table = $("#TodayReceiving_Table").DataTable({
                "ajax": ({
                    url: '@Url.Action("RPTESC001_ReceivedSummaryTable", "Warehouse")',
                    type: 'POST',
                    data: request,
                    dataType: 'Json'
                }),
                scrollX: true,//
                //ordering: false,//
                "bSort": true,
                order: [],
                responsive: true,
                searching: false,
                paging: false,
                lengthChange: false,
                pageLength: 10,
                fixedColumns: {
                    heightMatch: 'none'
                },
                columns: [
                    { "data": "customer_name", className: "text-nowrap" },
                    { "data": "transport_type", className: "text-nowrap" },
                    { "data": "total_qty_today", className: "text-nowrap", "render": uiHelpers.renderInteger},
                    { "data": "received_qty_today", className: "text-nowrap", "render": uiHelpers.renderInteger },
                    { "data": "putaway_qty_today", className: "text-nowrap", "render": uiHelpers.renderInteger},
                    { "data": "outstanding_qty_today", className: "text-nowrap", "render": uiHelpers.renderInteger},
                    //{ "data": "putaway_percent", className: "text-nowrap" },
                    {
                        "data": "putaway_percent", className: "text-nowrap",
                        "render": function (data, type, row, meta) {
                            return parseFloat(data).toFixed(2);
                        }
                    },

                ]
            });


        }


        //
        // Get ReceivedByTime Chart
        //


        function GetReceivedByTimeChart(request) {
            $('#barChartReceivedByTime').remove();
            $('#barChartReceivedByTimeContainer').append('<canvas id="barChartReceivedByTime"><canvas>');

            $.ajax({
                url: '@Url.Action("RPTESC001_ReceivedByTimeBarChart", "Warehouse")',
                type: 'POST',
                data: request,
                dataType: 'Json'
            }).done(function (response) {
                var ctx = document.getElementById("barChartReceivedByTime").getContext('2d');
                var myChart = new Chart(ctx, {
                    type: 'bar',
                    data: response,
                    options: {
                        scales: {
                            xAxes: [{
                                stacked: true,
                                gridLines: {
                                    display: false,
                                }
                                ,
                                scaleLabel: {
                                    display: true,
                                    labelString: "Time"
                                }
                            }],
                            yAxes: [{
                                stacked: true,
                                ticks: {
                                    beginAtZero: true,
                                },
                                type: 'linear',
                                scaleLabel: {
                                    display: true,
                                    labelString: 'Ton'
                                }
                            }]
                        },
                        elements: {
                            line: {
                                fill: false
                            }
                        },
                        responsive: true,
                        maintainAspectRatio: false,
                        legend: {
                            position: "bottom"
                        },
                        title: {
                            display: true,
                            text: "การรับสินค้าตามช่วงเวลา"
                        }
                    }
                });
                var canvas = document.getElementById('barChartReceivedByTime');
                canvas.onclick = function (evt) {
                    var activePoints = myChart.getElementsAtEvent(evt);
                    if (activePoints[0]) {

                        //label
                        var chartData = activePoints[0]['_chart'].config.data;
                        var idx = activePoints[0]['_index'];
                        var Timelabel = chartData.labels[idx];

                        //data
                        var activePoint = myChart.getElementAtEvent(evt)[0];
                        var data = activePoint._chart.data;
                        var datasetIndex = activePoint._datasetIndex;
                        var CustomerLabel = data.datasets[datasetIndex].label;
                        //var value = data.datasets[datasetIndex].data[activePoint._index];
                        console.log(Timelabel.slice(0, -3) + ";" + CustomerLabel);
                        Timelabel = Timelabel.slice(0, -3);
                    }
                    genTableModal({ CustomerName: CustomerLabel, Time: Timelabel, Datetype: 'A' });
                    @*DrawTableDetail(getRequest(CustomerLabel, null, Timelabel, 'A'));*@
                };

            }).fail(function (error) {
                console.log(error);
            }).always(function () {
                $('#SectionBarChartReceivedBytime').hide();
                //console.log( "finished" );
            });

            $('#pieChartReceivedByTime').remove();
            $('#pieChartReceivedByTimeContainer').append('<canvas id="pieChartReceivedByTime"><canvas>');

             $.ajax({
                url: '@Url.Action("RPTESC001_ReceivedByTimePieChart", "Warehouse")',
                type: 'POST',
                data: request,
                dataType: 'Json'
            }).done(function (response) {
                var ctx = document.getElementById("pieChartReceivedByTime").getContext('2d');
                var myChart = new Chart(ctx, {
                    type: 'pie',
                    data: response,
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        legend: {
                            position: "right"
                        },
                        title: {
                            display: true,
                            text: "สัดส่วนการรับสินค้าเข้าคลังตามช่วงเวลา "
                        }
                    }
                });
                var canvas = document.getElementById('pieChartReceivedByTime');
                canvas.onclick = function (evt) {
                    var activePoints = myChart.getElementsAtEvent(evt);
                    if (activePoints[0]) {

                        //label
                        var chartData = activePoints[0]['_chart'].config.data;
                        var idx = activePoints[0]['_index'];
                        var Timelabel = chartData.labels[idx];

                        //var value = data.datasets[datasetIndex].data[activePoint._index];
                        Timelabel = Timelabel.slice(0, -3);
                    }
                    @*DrawTableDetail(getRequest(null, null, Timelabel, 'A'));*@
                    genTableModal({ Time: Timelabel, Datetype: 'A' });
                };

            }).fail(function (error) {
                console.log(error);
            }).always(function () {
                $('#SectionPieChartReceivedBytime').hide();
                //console.log( "finished" );
            });

        }

    function DrawTableDetail(request) {
        $('#SectionReceivingDetail').show();
            //ESC Text
        var sectionReceivingDetailText = document.getElementById('ReceivingDetailText');
        var DateDis = GetDateDisplay();
        sectionReceivingDetailText.innerText = "รายละเอียดยอดสินค้าขารับประจำวันที่ " + DateDis.StartDate + "-" + DateDis.EndDate;

        var jqxhr = $.post("/Warehouse/RPTESC001_RecivingReport", request)
            .done(function (result) {
                //if (result.status) {
                if (table == null) {
                    GenerateDatatable(result.data, cdc_column);
                }
                else {
                    table.clear();
                    $.each(result.data, function (idx, obj) {
                        table.row.add(result.data[idx]);
                    });
                    table.draw();
                }
            })
            .fail(function (e) {
                console.log(e);
            })
            .always(function (e) {
                $('#SectionReceivingDetail').hide();
            });

        }
        function isEmpty(obj) {
            for (var key in obj) {
                if (obj.hasOwnProperty(key))
                    return false;
            }
            return true;
        }

        var isRtl = $('html').attr('dir') === 'rtl';
        $(function () {
            $('#datepicker-base').datepicker({
                format: "mm-yyyy",
                viewMode: "months",
                minViewMode: "months",
                orientation: isRtl ? 'auto right' : 'auto left'
            });
        });

</script>

<input type="hidden" id="reporttype" />
<!-- Content Start -->
<div class="content-wrapper">
    <h1>Warehouse</h1>
    <h4 class="card-title">รายการรับสินค้า (Receiving Report)</h4>
    <ul class="nav filled-tabs">
        <li class="nav-item">
            <a class="nav-link active show" data-toggle="tab" href="#filled-dashboard">Dashboard</a>
        </li>
        <li class="nav-item">
            <a class="nav-link" data-toggle="tab" href="#filled-rawdata">Raw Data</a>
        </li>
    </ul>
    <div class="tab-content">
        @{
            await Html.RenderPartialAsync("_Common_WH_ESC_Criteria_03");
        }
        <div class="tab-pane active show" id="filled-dashboard">
            <div class="row" style="margin-top:2%;">
                <div class="col-12 card-statistics">
                    <div class="row" id="div_summary" data-bind="foreach: summary">
                        <div id="SectionSummaryCompareReceive" class="overlay">
                            <div class="loader-wrap">
                                <div class="bar-loader">
                                    <span></span>
                                    <span></span>
                                    <span></span>
                                    <span></span>
                                </div>
                            </div>
                        </div>
                        <div class="col-12 col-sm-6 col-lg-3 mb-4">
                            <div class="card">
                                <div class="card-body" style="padding-bottom:2%;padding-top:2%;padding-left:5%;padding-right:5%">
                                    <div class="row">
                                        <div class="col align-items-center">
                                            <div class="d-flex justify-content-center">
                                                @*<h5>CDC วังน้อย</h5>*@
                                                <b data-bind="text:dc_name"></b>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="col align-items-center">
                                            <div class="d-flex justify-content-center">
                                                <p data-bind="text:$parent.xAxisLabel">Order</p>
                                            </div>
                                        </div>
                                    </div>
                                    <hr class="myhrline" />
                                    <div class="row ">
                                        <div class="col align-items-center">
                                            <div class="d-flex justify-content-center">
                                                <b data-bind="text: formatCurrency(total_order)"></b>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="col align-items-center">
                                            <div class="d-flex justify-content-center">
                                                <p>Total</p>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="col align-items-center">
                                            <div class="d-flex justify-content-start">
                                                <b data-bind="text: formatCurrency(received_order)">1000</b>
                                            </div>
                                        </div>
                                        <div class="col align-items-center">
                                            <div class="d-flex justify-content-end">
                                                <b data-bind="text: formatCurrency(outstanding_order)">2000</b>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="col align-items-center">
                                            <div class="d-flex justify-content-start">
                                                <p style="text-align:left">Receiving Done</p>
                                            </div>
                                        </div>
                                        <div class="col align-items-center">
                                            <div class="d-flex justify-content-end">
                                                <p style="text-align:right">Receiving OutStanding</p>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="col align-items-center">

                                            <div class="progress progress-xs">
                                                <div class="progress-bar bg-info" role="progressbar" data-bind="attr: {'aria-valuenow': formatCurrency((total_order/received_order)*100),} , style: {width:(received_order/total_order)*100+'%'}"
                                                     aria-valuemin="0" aria-valuemax="100"></div>
                                                <div class="progress-bar bg-danger" role="progressbar" data-bind="attr: {'aria-valuenow': formatCurrency(100-((total_order/received_order)*100)),} ,style: {width:100-((received_order/total_order)*100)+'%'}"
                                                     aria-valuemin="0" aria-valuemax="100"></div>
                                            </div>

                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="row">
                <div class="col-md-12">
                    <div class="card">
                        <div class="card-body">
                            <h4 class="card-title">แผนการรับสินค้าเข้าคลัง ประจำวันที่ <span id="TodayReceivingDate"></span></h4>
                            <div class="row" id="CompareReceiving">
                                @*//Today Receiving*@
                                <div class="col-md-12">
                                    <div class="card">
                                        <div id="SectionTodayCompareReceived" class="overlay">
                                            <div class="loader-wrap">
                                                <div class="bar-loader">
                                                    <span></span>
                                                    <span></span>
                                                    <span></span>
                                                    <span></span>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-12 d-flex align-items-center justify-content-between">
                                            <h4 class="card-title" id="TodayReceivingText"></h4>
                                            <div class="d-flex align-items-center">
                                                <div class="wrapper">
                                                    <a href="#" id="downloadPdf" onclick="uiHelpers.downloadPDF('#barChartTodayReceiving','TodayReceivingText'); return false;" class="btn btn-link d-inline-flex font-weight-bold">
                                                        <i class="icon-share-alt mr-1"></i>Download PDF
                                                    </a>
                                                </div>
                                            </div>
                                        </div>
                                        @*<canvas id="MeSeStatusCanvas"></canvas>*@
                                        <div class="card-body" id="barChartTodayReceivingLayout">
                                            <div id="barChartTodayReceivingContainer" class="chart-container" style="position: relative; height:30vh;">
                                                <canvas id="barChartTodayReceiving"></canvas>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                @*Yesterday Receiving*@
                                <div class="col-md-12">
                                    <div class="card">
                                        <div class="card-body" style="padding-bottom:2%;padding-top:2%;padding-left:5%;padding-right:5%">
                                            <h4 class="card-title" id="TodayReceivingDetailText"></h4>
                                            <div>
                                                <div class="dataTables_wrapper">
                                                    @*<table id="dtList" class="table table-striped" style="width:100%"></table>*@
                                                    <table class="table table-striped" id="TodayReceiving_Table" cellspacing="0" width="100%">
                                                        <thead>
                                                            <tr>

                                                                <th rowspan="2" tyle="text-align:center">Customer</th>
                                                                <th rowspan="2" tyle="text-align:center">Transport Type</th>
                                                                <th rowspan="2" style="text-align:center">Plan</th>
                                                                <th colspan="2" scope="colgroup" style="text-align:center">Status</th>
                                                                <th rowspan="2" style="text-align:center;">
                                                                    <div>Not received</div>
                                                                </th>
                                                                <th rowspan="2" style="text-align:center">
                                                                    <div>% Receiving</div><div>Done</div>
                                                                </th>

                                                            </tr>
                                                            <tr>
                                                                <th style="text-align:center">Received</th>
                                                                <th style="text-align:center">Putaway</th>
                                                            </tr>
                                                        </thead>
                                                        <tbody></tbody>
                                                    </table>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="row">
                <div class="col-md-12">
                    <div class="card">
                        <div class="card-body">
                            <h4 class="card-title">สรุปการรับสินค้าเข้าคลังตามช่วงเวลา ประจำวันที่ <span id="ChartDate"></span> </h4>
                            <div class="row" id="ReceivedByTime">
                                @*//Today Receiving*@
                                <div class="col-md-8">
                                    <div class="card">
                                        <div id="SectionBarChartReceivedBytime" class="overlay">
                                            <div class="loader-wrap">
                                                <div class="bar-loader">
                                                    <span></span>
                                                    <span></span>
                                                    <span></span>
                                                    <span></span>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-12 d-flex align-items-center justify-content-between">
                                            <h4 class="card-title" id="barChartReceivedByTimeText"></h4>
                                            <div class="d-flex align-items-center">
                                                <div class="wrapper">
                                                    <a href="#" id="downloadPdf" onclick="uiHelpers.downloadPDF('#barChartReceivedByTime','barChartReceivedByTimeText'); return false;" class="btn btn-link d-inline-flex font-weight-bold">
                                                        <i class="icon-share-alt mr-1"></i>Download PDF
                                                    </a>
                                                </div>
                                            </div>
                                        </div>
                                        @*<canvas id="MeSeStatusCanvas"></canvas>*@
                                        <div class="card-body" id="barChartReceivedByTimeLayout">
                                            <div id="barChartReceivedByTimeContainer" class="chart-container" style="position: relative; height:40vh;">
                                                <canvas id="barChartReceivedByTime"></canvas>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                @*Yesterday Receiving*@
                                <div class="col-md-4">
                                    <div class="card">
                                        <div id="SectionPieChartReceivedBytime" class="overlay">
                                            <div class="loader-wrap">
                                                <div class="bar-loader">
                                                    <span></span>
                                                    <span></span>
                                                    <span></span>
                                                    <span></span>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-12 d-flex align-items-center justify-content-between">
                                            <h4 class="card-title" id="pieChartReceivedByTimeText"></h4>
                                            <div class="d-flex align-items-center">
                                                <div class="wrapper">
                                                    <a href="#" id="downloadPdf" onclick="uiHelpers.downloadPDF('#pieChartReceivedByTime','pieChartReceivedByTimeText'); return false;" class="btn btn-link d-inline-flex font-weight-bold">
                                                        <i class="icon-share-alt mr-1"></i>Download PDF
                                                    </a>
                                                </div>
                                            </div>
                                        </div>
                                        @*<canvas id="MeSeStatusCanvas"></canvas>*@
                                        <div class="card-body" id="pieChartReceivedByTimeLayout">
                                            <div id="pieChartReceivedByTimeContainer" class="chart-container" style="position: relative; height:40vh;">
                                                <canvas id="pieChartReceivedByTime"></canvas>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            </div>
            <div class="tab-pane" id="filled-rawdata">
                <div class="row" id="ReceivingDetail">
                    <div class="col-12">
                        <article class="card mb-4">
                            <div id="SectionReceivingDetail" class="overlay">
                                <div class="loader-wrap">
                                    <div class="bar-loader">
                                        <span></span>
                                        <span></span>
                                        <span></span>
                                        <span></span>
                                    </div>
                                </div>
                            </div>
                            <div class="card-body">
                                <h4 class="card-title" id="ReceivingDetailText"></h4>
                                <div>
                                    <div class="dataTables_wrapper">
                                        <table id="dtList" class="table table-striped" style="width:100%"></table>
                                    </div>
                                </div>
                            </div>
                        </article>
                    </div>
                </div>
            </div>
        </div>
    </div>
            <!-- Content End -->
            <div class="modal modal-default" id="modals-transaction">
                <div class="modal-dialog-centered modal-dialog-scrollable" style="max-width: 80%;margin:auto">
                    <form class="modal-content">
                        <div class="modal-header">
                            <h4 class="modal-title">
                                รายละเอียดยอดสินค้าขารับประจำวันที่ <span id="ModalTransactionDate"></span>
                            </h4>
                            <button type="button" class="close" data-dismiss="modal" aria-label="Close">×</button>
                        </div>
                        <div class="modal-body">
                            <div class="form-row">
                                <div class="form-group col">
                                    <div class="row" id="ReceieveDetailModal">
                                        <div class="col-12">
                                            <div class="overlay section-loading">
                                                <div class="loader-wrap">
                                                    <div class="bar-loader">
                                                        <span></span>
                                                        <span></span>
                                                        <span></span>
                                                        <span></span>
                                                    </div>
                                                </div>
                                            </div>
                                            <h4 class="card-title section-title"></h4>
                                            <div class="table-responsive">
                                                <div class="dataTables_wrapper">
                                                    <table class="table table-striped section-table-render" style="width:100%"></table>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-primary waves-effect" data-dismiss="modal">Close</button>
                        </div>
                    </form>
                </div>
            </div>

            <script>var model = {
                    summary: ko.observableArray([]),
                    xAxisLabel: ko.observable()
                }

                ko.applyBindings(model, document.getElementById("div_summary"));
                function GetSummary(request) {
                    $('#SectionSummaryCompareReceive').show();
                    var jqxhr = $.post("/Warehouse/RPTESC001_ReceivedSummary", request)
                        .done(function (result) {

                            model.summary(result.datalist);
                            model.xAxisLabel(result.xAxislabelString);

                        })
                        .fail(function (e) {
                            console.log(e);
                        })
                        .always(function () {
                            $('#SectionSummaryCompareReceive').hide();

                            //console.log( "finished" );
                        });
                }
                var formatCurrency = function (amount) {
                    if (!amount) {
                        return "0";
                    }
                    amount += '';
                    x = amount.split('.');
                    x1 = x[0];
                    x2 = x.length > 1 ? '.' + x[1] : '';
                    var rgx = /(\d+)(\d{3})/;
                    while (rgx.test(x1)) {
                        x1 = x1.replace(rgx, '$1' + ',' + '$2');
                    }
                    return "" + x1 + x2;
                }</script>
